(()=>{var a={isMobile:()=>!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)),cachedScript:(e,t)=>$.ajax(jQuery.extend({url:e,type:"get",dataType:"script",cache:!0,success:t},$.isPlainObject(e)&&e)),formatDate(e,t="yyyy-MM-dd"){e=new Date(e),/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var a,r={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(a in r)if(new RegExp(`(${a})`).test(t)){let e=r[a]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?e:e.padStart(2,"0"))}return t},getUrlParams(){var e=location.search,e=(e="string"!=typeof e?e.toString():e).replace(/^[^\?]*\?/i,"").split(/&/),a={};return e.length<1||Array.isArray(e)&&e.forEach(function(e){if(!e)return!1;var t,e=e.split(/=/);2<=e.length&&(t=e.splice(0,1),a[t]=e.join("="))}),a},request:({url:e="",method:r="GET",data:s,headers:o={},timeout:i=1e4,returnRaw:n=!1})=>new Promise((t,a)=>{r=r.toUpperCase(),$.ajax({url:e,type:r,headers:{"API-Authorization":DreamConfig.access_key||"dream",...o},async:!0,dataType:"json",timeout:i,data:s,success(e){n?t(e):200===e.status?t(e.data||""):a(e)},error(e){e=e&&e.responseJSON?e.responseJSON.message:"请求失败";Qmsg.error(e),a(e)}})}),like(s,o,t){const i=s.attr("data-id"),n=encryption("agree-"+t);let e=localStorage.getItem(n);(e=e?JSON.parse(decrypt(e)):[]).includes(i)?s.removeClass("like"):s.on("click",function(e){e.stopPropagation(),a.request({url:"/api/content/"+t+"/"+i+"/likes",method:"POST"}).then(e=>{let t=localStorage.getItem(n);t=t?JSON.parse(decrypt(t)):[];var a=+(s.attr("data-likes")||0)+1,r=(t.push(i),s.removeClass("like"),encryption(JSON.stringify(t)));localStorage.setItem(n,r),s.off("click"),o.html(a),Qmsg.success("点赞成功")})})},sleep:(t=250)=>new Promise(e=>setTimeout(e,t)),foldBlock(e){if(DreamConfig.journals_fold_height){const a=$("body,html"),r=e.height();var t;e.is(".fold")?e.removeClass("fold"):(t=a.scrollTop(),e.addClass("fold"),a.scrollTop(t-r+e.height()))}},removeClassByPrefix(e,t){const a=e.className.split(" ").filter(function(e){return 0!==e.lastIndexOf(t,0)});e.className=a.join(" ").trim()}};window.Utils=a})();