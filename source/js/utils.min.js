(()=>{var a={formatDate(e,t="yyyy-MM-dd"){e=new Date(e),/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var a,r={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(a in r)if(new RegExp(`(${a})`).test(t)){let e=r[a]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?e:e.padStart(2,"0"))}return t},getUrlParams(){var e=location.search,e=(e="string"!=typeof e?e.toString():e).replace(/^[^\?]*\?/i,"").split(/&/),a={};return e.length<1||Array.isArray(e)&&e.forEach(function(e){if(!e)return!1;var t,e=e.split(/=/);2<=e.length&&(t=e.splice(0,1),a[t]=e.join("="))}),a},request:({url:e="",method:r="GET",data:s,headers:n={},timeout:o=1e4,returnRaw:l=!1})=>new Promise((t,a)=>{r=r.toUpperCase(),$.ajax({url:e,type:r,headers:{"API-Authorization":DreamConfig.access_key||"dream",...n},async:!0,dataType:"json",timeout:o,data:s,success(e){l?t(e):200===e.status?t(e.data||""):a(e)},error(e){e=e&&e.responseJSON?e.responseJSON.message:"请求失败";Qmsg.error(e),a(e)}})}),like(s,n,t){const o=s.attr("data-id"),l=encryption("agree-"+t);let e=localStorage.getItem(l);(e=e?JSON.parse(decrypt(e)):[]).includes(o)?s.removeClass("like"):s.on("click",function(e){e.stopPropagation(),a.request({url:"/api/content/"+t+"/"+o+"/likes",method:"POST"}).then(e=>{let t=localStorage.getItem(l);t=t?JSON.parse(decrypt(t)):[];var a=+(s.attr("data-likes")||0)+1,r=(t.push(o),s.removeClass("like"),encryption(JSON.stringify(t)));localStorage.setItem(l,r),s.off("click"),n.html(a),Qmsg.success("点赞成功")}).catch(e=>{console.log(e)})})},sleep:(t=250)=>new Promise(e=>setTimeout(e,t)),loadJS(e,t){a._loadRes("script",e,t)},loadCSS(e,t){a._loadRes("link",e,t)},_loadRes(e,t,a){var r,s=a||function(){};switch(e){case"script":(r=document.createElement(e)).type="text/javascript",r.src=t;break;case"link":(r=document.createElement(e)).type="text/css",r.type="stylesheet",r.href=t;break;default:return void console.warn("暂不支持："+e+" 类型")}r.readyState?r.onreadystatechange=function(){"loaded"!=r.readyState&&"complete"!=r.readyState||(r.onreadystatechange=null,s())}:r.onload=function(){s()},document.getElementsByTagName("head")[0].appendChild(r)},removeClassByPrefix(e,t){const a=e.className.split(" ").filter(function(e){return 0!==e.lastIndexOf(t,0)});e.className=a.join(" ").trim()}};window.Utils=a})();