(()=>{var r={formatDate(e,t="yyyy-MM-dd"){e=new Date(e),/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var r,s={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(r in s)if(new RegExp(`(${r})`).test(t)){let e=s[r]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?e:e.padStart(2,"0"))}return t},getUrlParams(){var e=location.search,e=(e="string"!=typeof e?e.toString():e).replace(/^[^\?]*\?/i,"").split(/&/),r={};return e.length<1||Array.isArray(e)&&e.forEach(function(e){if(!e)return!1;var t,e=e.split(/=/);2<=e.length&&(t=e.splice(0,1),r[t]=e.join("="))}),r},request:({url:e="",method:s="GET",data:a,headers:o={},timeout:l=1e4,returnRaw:n=!1})=>new Promise((t,r)=>{s=s.toUpperCase(),$.ajax({url:e,type:s,headers:{"API-Authorization":DreamConfig.access_key||"dream",...o},async:!0,dataType:"json",timeout:l,data:a,success(e){n?t(e):200===e.status?t(e.data||""):r(e)},error(e){e=e&&e.responseJSON?e.responseJSON.message:"请求失败";Qmsg.error(e),r(e)}})}),like(a,o,t){const l=a.attr("data-id"),n=encryption("agree-"+t);let e=localStorage.getItem(n);(e=e?JSON.parse(decrypt(e)):[]).includes(l)?a.removeClass("like"):a.on("click",function(e){e.stopPropagation(),r.request({url:"/api/content/"+t+"/"+l+"/likes",method:"POST"}).then(e=>{let t=localStorage.getItem(n);t=t?JSON.parse(decrypt(t)):[];var r=+(a.attr("data-likes")||0)+1,s=(t.push(l),a.removeClass("like"),encryption(JSON.stringify(t)));localStorage.setItem(n,s),a.off("click"),o.html(r),Qmsg.success("点赞成功")}).catch(e=>{console.log(e)})})},sleep:(t=250)=>new Promise(e=>setTimeout(e,t)),foldBlock(e){if(DreamConfig.journals_fold_height){const r=$("body,html"),s=e.height();var t;e.is(".fold")?e.removeClass("fold"):(t=r.scrollTop(),e.addClass("fold"),r.scrollTop(t-s+e.height()))}},removeClassByPrefix(e,t){const r=e.className.split(" ").filter(function(e){return 0!==e.lastIndexOf(t,0)});e.className=r.join(" ").trim()}};window.Utils=r})();