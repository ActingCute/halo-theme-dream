(()=>{var n={_version:"1.0.0",isMobile:()=>!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)),timeAgo(e){if(!e)return"未知时间";e=new Date(e).getTime();var t,r,a=(new Date).getTime()-e,o=Math.floor(a/864e5);return 0===o?(a=a%864e5,0===(t=Math.floor(a/36e5))?(a=a%36e5,0===(r=Math.floor(a/6e4))?(a=Math.round(a%6e4/1e3))<1?"刚刚":a+" 秒前":r+" 分钟前"):t+" 小时前"):o<0?"刚刚":1===o?"昨天":n.formatDate(e,"yyyy年MM月dd日 hh:mm")},formatDate(e,t="yyyy-MM-dd"){e=new Date(e),/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var r,a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(r in a)if(new RegExp(`(${r})`).test(t)){let e=a[r]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?e:e.padStart(2,"0"))}return t},getNavLangSub(){var e=navigator.language;return e=(e=e.substr(0,2))?e:navigator.browserLanguage},getUrlParams(){var e=location.search,e=(e="string"!=typeof e?e.toString():e).replace(/^[^\?]*\?/i,"").split(/&/),r={};return e.length<1||Array.isArray(e)&&e.forEach(function(e){if(!e)return!1;var t,e=e.split(/=/);2<=e.length&&(t=e.splice(0,1),r[t]=e.join("="))}),r},request:({url:e="",method:a="GET",data:o,headers:n={},timeout:i=1e4,returnRaw:s=!1})=>new Promise((t,r)=>{a=a.toUpperCase(),$.ajax({url:""+e+("GET"===a?`${-1===e.indexOf("?")?"?":"&"}_r=`+Date.now():""),type:a,headers:{"API-Authorization":ThemeConfig.access_key||"joe2.0",...n},async:!0,dataType:"json",timeout:i,data:o,success(e){s?t(e):200===e.status?t(e.data||""):r(e)},error(e){e=e&&e.responseJSON?e.responseJSON.message:"出错了！";Qmsg.error(e),r(e)}})}),throttle(a,o=250){let n,i;return function(){const e=this,t=[...arguments],r=Date.now();i&&i+o>r?(clearTimeout(n),n=null,n=setTimeout(()=>{i=r,a.apply(e,t)},o)):(i=r,a.apply(e,t))}},sleep:(t=250)=>new Promise(e=>setTimeout(e,t)),setCookie(e,t,r){var a,e=e+n._version,o="";r&&((a=new Date).setTime(a.getTime()+24*r*60*60*1e3),o="; expires="+a.toUTCString()),document.cookie=e+"="+(t||"")+o+"; path=/"},getCookie(e){for(var t=e+n._version+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var o=r[a];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null},removeCookie(e){e=e+n._version+"=";document.cookie=e+"=; Max-Age=-99999999;"},setLocalStorage(t,r,a=3600){var e=t+n._version,o=new Date;try{localStorage.setItem(e,JSON.stringify({expires:o.valueOf()+1e3*a,data:r}))}catch(e){"QuotaExceededError"===e.name&&(console.log("数据已满，自动清空"),localStorage.clear(),setLocalStorage(t,r,a))}},getLocalStorage(e){var e=e+n._version,t=JSON.parse(localStorage.getItem(e)),r=new Date;return t&&t.expires>r?t.data:(localStorage.removeItem(e),null)},removeLocalStorage(e){e+=n._version;localStorage.removeItem(e)},loadJS(e,t){n._loadRes("script",e,t)},loadCSS(e,t){n._loadRes("link",e,t)},_loadRes(e,t,r){var a,o=r||function(){};switch(e){case"script":(a=document.createElement(e)).type="text/javascript",a.src=t;break;case"link":(a=document.createElement(e)).type="text/css",a.type="stylesheet",a.href=t;break;default:return void console.warn("暂不支持："+e+" 类型")}a.readyState?a.onreadystatechange=function(){"loaded"!=a.readyState&&"complete"!=a.readyState||(a.onreadystatechange=null,o())}:a.onload=function(){o()},document.getElementsByTagName("head")[0].appendChild(a)},getRandomColor(e=0,t=1){return e=e||0,t=t||0,e=isNaN(e)?0:Number(e),t=isNaN(t)?1:Number(t),e=Math.min(Math.max(Math.abs(e),0),1),t=(t=Math.min(Math.max(Math.abs(t),0),1))<e?1:t,"#"+(t=(16777216*(Math.random()*(t-e)+e)<<0).toString(16),new Array(7-t.length).join("0")+t)},removeClassByPrefix(e,t){const r=e.className.split(" ").filter(function(e){return 0!==e.lastIndexOf(t,0)});e.className=r.join(" ").trim()},renderedEmojiHtml(e){const t=new DOMParser;return n.removeNotEmoji(t.parseFromString(e,"text/html")).body.innerHTML},trimTailBr:e=>e.replace(/((\s|&nbsp;)*\r?\n)+$/g,""),limitBr:e=>e.replace(/((\s|&nbsp;)*\r?\n){3,}/g,""),trimHeadBr:e=>e.replace(/^((\s|&nbsp;)*\r?\n)+/g,""),removeNotEmoji(e){var t=e.getElementsByClassName("emoji-img");let r=!0;for(let e=0;e<t.length;e++){const a=t[e].dataset.icon;if(!n.findEmoji("tieba",a)&&!n.findEmoji("haha",a)){r=!1;break}}if(r)return e;const a=t[0],o=a.dataset.icon;return n.findEmoji("tieba",o)||n.findEmoji("haha",o)||n.removeNode(a),n.removeNotEmoji(e)},removeNode(e){var t=e.getAttribute("alt"),t=document.createTextNode(t);e.parentNode.replaceChild(t,e)},findEmoji:(t,r)=>0<emojiData.filter(e=>e.category===t&&e.name===r).length,return2Br:e=>(e=n.trimHeadBr(e),e=n.trimTailBr(e),n.limitBr(e))};window.Utils=n})();