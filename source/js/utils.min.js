(()=>{var r={formatDate(e,t="yyyy-MM-dd"){e=new Date(e),/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var r,a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(r in a)if(new RegExp(`(${r})`).test(t)){let e=a[r]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?e:e.padStart(2,"0"))}return t},getUrlParams(){var e=location.search,e=(e="string"!=typeof e?e.toString():e).replace(/^[^\?]*\?/i,"").split(/&/),r={};return e.length<1||Array.isArray(e)&&e.forEach(function(e){if(!e)return!1;var t,e=e.split(/=/);2<=e.length&&(t=e.splice(0,1),r[t]=e.join("="))}),r},request:({url:e="",method:a="GET",data:s,headers:o={},timeout:n=1e4,returnRaw:l=!1})=>new Promise((t,r)=>{a=a.toUpperCase(),$.ajax({url:e,type:a,headers:{"API-Authorization":DreamConfig.access_key||"dream",...o},async:!0,dataType:"json",timeout:n,data:s,success(e){l?t(e):200===e.status?t(e.data||""):r(e)},error(e){e=e&&e.responseJSON?e.responseJSON.message:"请求失败";Qmsg.error(e),r(e)}})}),like(s,o,t){const n=s.attr("data-id"),l=encryption("agree-"+t);let e=localStorage.getItem(l);(e=e?JSON.parse(decrypt(e)):[]).includes(n)?s.removeClass("like"):s.on("click",function(e){e.stopPropagation(),r.request({url:"/api/content/"+t+"/"+n+"/likes",method:"POST"}).then(e=>{let t=localStorage.getItem(l);t=t?JSON.parse(decrypt(t)):[];var r=+(s.attr("data-likes")||0)+1,a=(t.push(n),s.removeClass("like"),encryption(JSON.stringify(t)));localStorage.setItem(l,a),s.off("click"),o.html(r),Qmsg.success("点赞成功")}).catch(e=>{console.log(e)})})},sleep:(t=250)=>new Promise(e=>setTimeout(e,t)),removeClassByPrefix(e,t){const r=e.className.split(" ").filter(function(e){return 0!==e.lastIndexOf(t,0)});e.className=r.join(" ").trim()}};window.Utils=r})();