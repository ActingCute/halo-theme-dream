(()=>{const n="Dream-1.0.0";let s=!1;const i=[new RegExp(location.origin+"/themes","i"),/\/\/(unpkg\.com|npm\.elemecdn\.com|cdn\.jsdelivr\.net)\/.*/i],o=[new RegExp(location.origin+"/upload","i"),/\/\/cdn.jsdelivr.net\/gh.*/i],a=[new RegExp(location.origin+"/(admin|api)","i")],c={theme:{originUrl:location.origin+"/themes/dream",handleRequest:e=>{var t,n;if(0===e.indexOf(c.theme.originUrl))return t=e.substring(c.theme.originUrl.length),n=new URLSearchParams(e.split("?")[1]).get("mew")||"latest",[e,"https://unpkg.com/halo-theme-dream@"+n+t,"https://cdn.jsdelivr.net/gh/nineya/halo-theme-dream@"+n+t]}},npm:{urlTemplates:["https://unpkg.com","https://cdn.jsdelivr.net/npm","https://npm.elemecdn.com"],handleRequest:e=>{var t,n=c.npm.urlTemplates,r=e;for(t in n)if(0===r.indexOf(n[t])){const s=r.substring(n[t].length);return n.map(e=>e+s)}}}};function u(e,t){return e.some(function(e){return e.test(t)})}function l(e,t){const n=new Set(["mew","v","version","t","time","ts","timestamp"]),r=e.split("?"),s=t.split("?");if(r[0]===s[0]){const i=new URLSearchParams("?"+r[1]),o=new URLSearchParams("?"+s[1]);for(const e of i.keys())if(!n.has(e)&&i.get(e)!==o.get(e))return;return 1}}self.addEventListener("install",function(e){console.log(s),e.waitUntil(self.skipWaiting())}),self.addEventListener("activate",function(e){const t=[n];return s=new URLSearchParams(location.href.split("?")[1]).get("offLine"),e.waitUntil(caches.keys().then(function(e){return Promise.all(e.map(function(e){if(-1===t.indexOf(e))return console.info("version changed, clean the cache, SW: deleting "+e),caches.delete(e)}))})),self.clients.claim()}),self.addEventListener("fetch",function(r){if("GET"!==r.request.method)return!1;const e=u(o,r.request.url),t=u(i,r.request.url);if(!e&&!t||u(a,r.request.url))return!!s&&(r.respondWith(fetch(r.request).then(e=>{const t=e.clone();return caches.open(n).then(e=>e.put(r.request,t)),e}).catch(()=>caches.match(r.request))),!0);r.respondWith(caches.open(n).then(function(t){return t.matchAll(r.request,{ignoreSearch:!0}).then(function(n){return function(e){if(n)for(const t of n)if((t.url||t.headers.get("service-worker-origin"))===e)return t;return null}(r.request.url)||function(e,t){if(t)return fetch(e);var n=e.url;for(const e in c){const t=c[e].handleRequest(n);if(t){var r=n;var s=t;const i=new AbortController,o=i.signal,a=s.map(e=>new Promise(async(t,n)=>{fetch(e,{signal:o}).then(async e=>{const t=new Headers(e.headers);return t.set("service-worker-origin",r),new Response(await e.arrayBuffer(),{status:e.status,headers:t})}).then(e=>{200!==e.status&&n(null),i.abort(),t(e)}).catch(()=>n(null))}));return Promise.any||(Promise.any=function(e){return new Promise((t,n)=>{let r=(e=Array.isArray(e)?e:[]).length,s=[];if(0===r)return n(new AggregateError("All promises were rejected"));e.forEach(e=>{if(!e instanceof Promise)return n(e);e.then(e=>t(e),e=>{r--,s.push(e),0===r&&n(new AggregateError(s))})})})}),Promise.any(a);return}}return fetch(e)}(r.request,e).then(e=>{if(n)for(const e of n)l(e.url,r.request.url)&&t.delete(e.url);return t.put(r.request,e.clone()),e}).catch(e=>{if(console.error(e),n)for(const e of n)if(l(e.url,r.request.url))return e})})}))})})();