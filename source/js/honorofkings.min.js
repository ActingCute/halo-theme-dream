(()=>{var e=null,o=$("#honorofkings_api").val()||"https://haibarai.com/timi";axios.defaults.baseURL=o,console.log({honorofkings_api:o});function a(){0!==$(".honorofkings").length&&(e=new Vue({el:"#honorofkings",data:{roleWx:[],roleQQ:[],isLogin:!1,isLoading:!0,queryParams:{start:0,limit:15},userInfo:{name:"一个小可爱",avatar:"//game.gtimg.cn/images/yxzj/web201605/page/per_pic1.jpg",credit:0,grade:"小青铜",gradeImg:"//game.gtimg.cn/images/yxzj/web201605/page/rank15.png",ladderWinRate:"0%",ladderInfo:["全部比赛：0 胜场：0 胜率：0%","排位赛：0 胜场：3317 胜率：0%"],heroCount:0,skinCount:0,updateTime:"无更新"},honorofkingsContents:[],isEnd:!1},created(){},mounted(){},methods:{init(){console.log("init");let e=localStorage.getItem("HALO__Access-Token");e&&(e=JSON.parse(e)).value&&e.value.access_token&&$.ajax({url:"/api/admin/attachments",type:"GET",beforeSend:function(o){o.setRequestHeader("Admin-Authorization",e.value.access_token)}}).then(o=>{this.isLogin=200==o.status,this.isLogin&&(axios.get("/wz/getRole?type=1").then(o=>{console.log(o),200==o.status&&1e4==o.data.Code&&(this.roleWx=o.data.Data)}),axios.get("/wz/getRole?type=2").then(o=>{200==o.status&&1e4==o.data.Code&&(this.roleQQ=o.data.Data)}))}).catch(o=>{console.error(o)}),$(".noHonorofkings").show(),this.sLoading=!0,$(".honorofkings").addClass("loading");var o=axios.get("/user/info");axios.all([this.getRecordData(this.queryParams),o]).then(o=>{var e;console.log({res:o}),2==o.length&&(e=o[0],o=o[1],this.setRecordData(e),1e4==o.data.Code&&(this.userInfo=o.data.Data),$(".honorofkings").show())}).catch(o=>console.error(o)).finally(()=>{console.log("finally"),$(".honorofkings").removeClass("loading"),this.isLoading=!1})},getRecordData:o=>axios.get("/record/get",{params:o}),async getMore(o){o=await this.getRecordData(o);this.setRecordData(o)},setRecordData(o){1e4==o.data.Code?0!==(o=o.data.Data.data||[]).length?(this.isEnd=o.length<this.queryParams.limit,this.honorofkingsContents=o,$(".noHonorofkings").hide()):this.isEnd=!0:console.error("获取王者战绩数据失败")}}}))}window.honorofkingsPjax=function(o){0!==$(".honorofkings").length&&(a(),e&&e.init())},a(),!window.pjaxSerialNumber&&e&&e.init()})();