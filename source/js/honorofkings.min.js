(()=>{var o=null,a=$("#honorofkings_api").val()||"/timi";console.log({honorofkings_api:a});function t(){0!==$(".honorofkings").length&&(o=new Vue({el:"#honorofkings",data:{show:!1,roleData:[],loginData:{loginType:0,code:0,equipment:0},viewRole:!1,roleWx:[],roleQQ:[],isLogin:!1,isLoading:!0,loading:!1,queryParams:{start:0,limit:15},userInfo:{name:"一个小可爱",avatar:"//game.gtimg.cn/images/yxzj/web201605/page/per_pic1.jpg",credit:0,grade:"小青铜",gradeImg:"//game.gtimg.cn/images/yxzj/web201605/page/rank15.png",ladderWinRate:"0%",ladderInfo:["全部比赛：0 胜场：0 胜率：0%","排位赛：0 胜场：3317 胜率：0%"],heroCount:0,skinCount:0,updateTime:"无更新"},honorofkingsContents:[],isEnd:!1},created(){this.show=!0},mounted(){},methods:{syncData(){var e;this.loading?alert("请稍后"):this.loginData.loginType&&this.loginData.equipment&&this.loginData.code?(e=JSON.parse(JSON.stringify(this.loginData)),e={loginType:Number(e.loginType),code:Number(e.code),equipment:Number(e.equipment)},axios.post(a+"/record/login",e).then(e=>{var o;200==e.status&&1e4==e.data.Code?(console.log("res==",e),alert("请在30秒内完成扫码"),o=(a+e.data.Data.data).replace("//public","/public"),console.log({imgPath:o}),window.open(o)):(console.error(e),alert("操作失败"),this.loading=!1),this.loading=!1}).catch(e=>{this.loading=!1,alert("操作失败"),console.error(e)})):alert("请完成选择")},setRole(){if(this.loginData.loginType&&this.loginData.equipment){let o="weixin",a="ios",e=this.roleWx;2==this.loginData.loginType&&(o="qq",e=this.roleQQ),2<this.loginData.equipment&&(a="android"),this.roleData=e.filter(e=>e.ck==o&&e.sk==a)}},toViewRole(e){e?$("#modal").css("dispaly","block"):$("#modal").css("dispaly","none"),this.viewRole=e},init(){console.log("init");let o=localStorage.getItem("HALO__Access-Token");o&&(o=JSON.parse(o)).value&&o.value.access_token&&$.ajax({url:a+"/api/admin/attachments",type:"GET",beforeSend:function(e){e.setRequestHeader("Admin-Authorization",o.value.access_token)}}).then(e=>{this.isLogin=200==e.status,this.isLogin&&(axios.get(a+"/wz/getRole?type=1").then(e=>{console.log(e),200==e.status&&1e4==e.data.Code&&(this.roleWx=e.data.Data)}),axios.get(a+"/wz/getRole?type=2").then(e=>{200==e.status&&1e4==e.data.Code&&(this.roleQQ=e.data.Data)}))}).catch(e=>{console.error(e)}),$(".noHonorofkings").show(),this.sLoading=!0,$(".honorofkings").addClass("loading");var e=axios.get(a+"/user/info");axios.all([this.getRecordData(this.queryParams),e]).then(e=>{var o;console.log({res:e}),2==e.length&&(o=e[0],e=e[1],this.setRecordData(o),1e4==e.data.Code&&(this.userInfo=e.data.Data),$(".honorofkings").show())}).catch(e=>console.error(e)).finally(()=>{console.log("finally"),$(".honorofkings").removeClass("loading"),this.isLoading=!1})},getRecordData:e=>axios.get(a+"/record/get",{params:e}),async getMore(e){e=await this.getRecordData(e);this.setRecordData(e)},setRecordData(e){1e4==e.data.Code?0!==(e=e.data.Data.data||[]).length?(this.isEnd=e.length<this.queryParams.limit,this.honorofkingsContents=e,$(".noHonorofkings").hide()):this.isEnd=!0:console.error("获取王者战绩数据失败")}}}))}window.honorofkingsPjax=function(e){0!==$(".honorofkings").length&&(t(),o&&o.init())},t(),!window.pjaxSerialNumber&&o&&o.init()})();