(()=>{var e=null,a=$("#honorofkings_api").val()||"/wz",t=(console.log({honorofkings_api:a}),location.hostname);function i(){0!==$(".honorofkings").length&&(e=new Vue({el:"#honorofkings",data:{show:!1,roleData:[],loginData:{hostname:t,loginType:1,code:4078,equipment:2},viewRole:!1,roleWx:[],roleQQ:[],isLogin:!1,isLoading:!0,loading:!1,queryParams:{start:0,limit:10,hostname:t},userInfo:{name:"一个小可爱",avatar:"//game.gtimg.cn/images/yxzj/web201605/page/per_pic1.jpg",credit:0,grade:"小青铜",gradeImg:"//game.gtimg.cn/images/yxzj/web201605/page/rank15.png",ladderWinRate:"0%",ladderInfo:["全部比赛：0 胜场：0 胜率：0%","排位赛：0 胜场：0 胜率：0%"],heroCount:0,skinCount:0,updateTime:"无更新"},honorofkingsContents:[],isEnd:!1},created(){this.show=!0,window.addEventListener("scroll",()=>{var o=$("#honorofkings");0!==o.length&&$(window).scrollTop()+$(window).height()>=o.height()&&(this.isEnd&&($(".honorofkings").removeClass("loading"),this.isLoading=!1),this.isLoading||this.isEnd||(this.queryParams.start++,this.getMore(this.queryParams)))})},mounted(){},methods:{syncData(){var o;this.loading?alert("请稍后"):this.loginData.loginType&&this.loginData.equipment&&this.loginData.code?(o=JSON.parse(JSON.stringify(this.loginData)),o={hostname:t,loginType:Number(o.loginType),code:Number(o.code),equipment:Number(o.equipment)},axios.post(a+"/getCode",o).then(o=>{var e;200==o.status&&1e4==o.data.code?(console.log("res==",o),alert("请在30秒内完成扫码"),e=(a+o.data.data.data).replace("//public","/"),console.log({imgPath:e}),window.open(e)):(console.error(o),alert("操作失败"),this.loading=!1),this.loading=!1}).catch(o=>{this.loading=!1,alert("操作失败"),console.error(o)})):alert("请完成选择")},setRole(){if(this.loginData.loginType&&this.loginData.equipment){let e="weixin",a="ios",o=this.roleWx;2==this.loginData.loginType&&(e="qq",o=this.roleQQ),2<this.loginData.equipment&&(a="android"),this.roleData=o.filter(o=>o.ck==e&&o.sk==a)}},toViewRole(o){o?$("#modal").css("dispaly","block"):$("#modal").css("dispaly","none"),this.viewRole=o},async init(){$(".noHonorofkings").show();let e=localStorage.getItem("HALO__Access-Token");e&&(e=JSON.parse(e)).value&&e.value.access_token&&$.ajax({url:"/api/admin/attachments",type:"GET",beforeSend:function(o){o.setRequestHeader("Admin-Authorization",e.value.access_token)}}).then(o=>{this.isLogin=200==o.status,this.isLogin&&(axios.get(a+"/getRole?type=1").then(o=>{console.log(o),200==o.status&&1e4==o.data.code&&(this.roleWx=o.data.data)}),axios.get(a+"/getRole?type=2").then(o=>{200==o.status&&1e4==o.data.code&&(this.roleQQ=o.data.data)}))}).catch(o=>{console.error(o)}),axios.all([this.getRecordData(this.queryParams),axios.post(a+"/getUserInfoData",{hostname:t})]).then(o=>{var e;console.log({res:o}),2==o.length&&(e=o[0].data,o=o[1].data,this.setRecordData(e),1e4==o.code&&(this.userInfo=o.data.data),$(".honorofkings").show())}).catch(o=>console.error(o)).finally(()=>{console.log("finally"),$(".honorofkings").removeClass("loading"),this.isLoading=!1})},getRecordData(o){return this.isLoading=!0,$(".honorofkings").addClass("loading"),axios.post(a+"/getRecord",o)},async getMore(o){this.isLoading=!0,$(".honorofkings").addClass("loading");o=await this.getRecordData(o);this.setRecordData(o.data)},setRecordData(o){var e;1e4==o.code?(0!=(e=o.data.data||[]).length?(this.isEnd=this.honorofkingsContents.length>=o.data.total,this.honorofkingsContents.push(...e),$(".noHonorofkings").hide()):this.isEnd=!0,this.isLoading=!1):console.error("获取王者战绩数据失败")}}}))}window.honorofkingsPjax=function(o){0!==$(".honorofkings").length&&(i(),e&&e.init())},i(),!window.pjaxSerialNumber&&e&&e.init()})();