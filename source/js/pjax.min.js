(()=>{const c=new Set($('link[href*=".css"]').map((o,n)=>$(n).attr("href")).get()),i=new Set($('script[src*=".js"]').map((o,n)=>$(n).attr("src")).get()),n=()=>{var o=(new Date).getTime();return window.pjaxSerialNumber=o,console.log("sn = "+o),o},l=(n,e,t)=>{if(e>=n.length)t&&t();else{let o=$(n[e]).attr("src");i.has(o)?l(n,e+1,t):(console.log((t?"同步":"异步")+"顺序加载js "+o),Utils.cachedScript(o).done(function(){console.log((t?"同步":"异步")+"顺序加载js完成 "+o),i.add(o),window.DProgress&&DProgress.inc(),l(n,e+1,t)}).fail(function(){console.log((t?"同步":"异步")+"顺序加载js失败 "+o),l(n,e+1,t)}))}};$(document).on("click","a[target!=_blank][href]:not(data-not-pjax)",o=>{window.DProgress&&DProgress.start(),$.pjax.click(o,".column-main",{scrollTo:0,fragment:".column-main",serialNumber:n(),timeout:8e3})}),$(document).on("submit","form[data-pjax]",function(o){window.DProgress&&DProgress.start(),$.pjax.submit(o,".column-main",{scrollTo:0,fragment:".column-main",serialNumber:n(),timeout:8e3})}),$(document).on("pjax:click",function(o,n){console.log("------------------------"),console.log("pjax:click sn = "+n.serialNumber)}),$(document).on("pjax:beforeSend",function(o,n,e){console.log("pjax:beforeSend sn = "+e.serialNumber)}),$(document).on("pjax:start",function(o,n,e){console.log("pjax:start sn = "+e.serialNumber)}),$(document).on("pjax:send",function(o,n,e){console.log("pjax:send sn = "+e.serialNumber)}),$(document).on("pjax:clicked",function(o,n){console.log("pjax:clicked sn = "+n.serialNumber)}),$(document).on("pjax:beforeReplace",function(o,n,e){console.log("pjax:beforeReplace sn = "+e.serialNumber),$(".navbar-nav .current,.panel-side-menu .current").removeClass("current"),commonContext.initNavbar(),0<$("html.disable-scroll").length&&$(".navbar-mask").trigger("click")}),$(document).on("pjax:success",async function(o,n,e,t,s){s=s.serialNumber;if(console.log("pjax:success sn = "+s),pjaxSerialNumber===s){commonContext.initGallery(),commonContext.initTocAndNotice();const r=$($.parseHTML(n,document,!0)),a=$("head");r.filter("link[data-pjax]").each(function(){let o=$(this).attr("href");c.has(o)||(a.append($(this)),console.log("加载css "+$(this).attr("href")),this.onload=function(){c.add(o),window.DProgress&&DProgress.inc(),console.log("加载css完成 "+$(this).attr("href"))})});let o=r.filter("script[data-pjax]");if(0<o.length){o.filter("[async]").each(function(){let o=$(this).attr("src");i.has(o)||(console.log("异步无序加载js "+o),Utils.cachedScript(o).done(function(){console.log("异步无序js完成 "+o),window.DProgress&&DProgress.inc(),i.add(o)}).fail(function(){console.log("异步无序js失败 "+o)}))}),new Promise(()=>{l(o.filter("[defer]"),0)});let n=o.filter(":not([async]):not([defer])");0<n.length&&await new Promise(o=>{l(n,0,o)})}console.log("全部处理完成"),pjaxSerialNumber===s&&(window.journalPjax&&window.journalPjax(s),window.postPjax&&window.postPjax(s),window.photoPjax&&window.photoPjax(s),window.honorofkingsPjax&&window.honorofkingsPjax(s),commonContext.loadMaintain(),window.DProgress&&DProgress.done())}}),$(document).on("pjax:timeout",function(o,n,e){console.log("pjax:timeout sn = "+e.serialNumber)}),$(document).on("pjax:error",function(o,n,e,t,s){console.log(`pjax:error sn = ${s.serialNumber} error `+t)}),$(document).on("pjax:complete",function(o,n,e,t){console.log("pjax:complete sn = "+t.serialNumber)}),$(document).on("pjax:end",function(o,n,e){console.log("pjax:end sn = "+e.serialNumber),null==n&&(commonContext.initTocAndNotice(),window.DProgress&&DProgress.done())}),$(document).on("pjax:popstate",function(){console.log("pjax:popstate")})})();