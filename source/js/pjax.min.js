(()=>{const o=()=>{var e=(new Date).getTime();return window.pjaxSerialNumber=e,console.log("sn = "+e),e};$(document).on("click","a[target!=_blank][href]:not(data-not-pjax)",e=>{$.pjax.click(e,".column-main",{scrollTo:0,fragment:".column-main",serialNumber:o(),timeout:8e3})}),$(document).on("submit","form[data-pjax]",function(e){$.pjax.submit(e,".column-main",{scrollTo:0,fragment:".column-main",serialNumber:o(),timeout:8e3})}),$(document).on("pjax:click",function(e,o){console.log("------------------------"),console.log("pjax:click sn = "+o.serialNumber)}),$(document).on("pjax:beforeSend",function(e,o,n){console.log("pjax:beforeSend sn = "+n.serialNumber)}),$(document).on("pjax:start",function(e,o,n){console.log("pjax:start sn = "+n.serialNumber)}),$(document).on("pjax:send",function(e,o,n){console.log("pjax:send sn = "+n.serialNumber)}),$(document).on("pjax:clicked",function(e,o){console.log("pjax:clicked sn = "+o.serialNumber)}),$(document).on("pjax:beforeReplace",function(e,o,n){console.log("pjax:beforeReplace sn = "+n.serialNumber),$(".navbar-nav .current,.panel-side-menu .current").removeClass("current"),commonContext.initNavbar(),0<$("html.disable-scroll").length&&$(".navbar-mask").trigger("click")}),$(document).on("pjax:success",async function(e,o,n,t,a){console.log("pjax:success sn = "+a.serialNumber),commonContext.initGallery(),commonContext.initTocAndNotice();const c=$($.parseHTML(o,document,!0)),l=$(document),s=$("head");var r;c.filter("link[data-pjax]").each(function(){0===l.find(`link[href='${$(this).attr("href")}']`).length&&(s.append($(this)),console.log("加载css "+$(this).attr("href")))});for(r of c.filter("script[data-pjax]")){let n=$(r).attr("src");if(0===l.find(`script[src='${n}']`).length)if(r.defer||r.async)s.append($(r)),console.log("异步加载js "+n);else{console.log("同步加载js "+n);let o=document.createElement("script"),e=document.getElementsByTagName("head")[0];o.type="text/javascript",o.src=n,e.appendChild(o),await new Promise(function(e){o.onload=o.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o.onload=o.onreadystatechange=null,console.log("加载js完成 "+n),e())}})}}console.log("全部处理完成"),window.journalPjax&&window.journalPjax(),window.postPjax&&window.postPjax()}),$(document).on("pjax:timeout",function(e,o,n){console.log("pjax:timeout sn = "+n.serialNumber)}),$(document).on("pjax:error",function(e,o,n,t,a){console.log(`pjax:error sn = ${a.serialNumber} error `+t)}),$(document).on("pjax:complete",function(e,o,n,t){console.log("pjax:complete sn = "+t.serialNumber)}),$(document).on("pjax:end",function(e,o,n){console.log("pjax:end sn = "+n.serialNumber),null==o&&commonContext.initTocAndNotice()}),$(document).on("pjax:popstate",function(){console.log("pjax:popstate")})})();