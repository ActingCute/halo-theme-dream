(()=>{const i=new Set($('link[href*=".css"]').map((o,e)=>$(e).attr("href")).get()),u=new Set($('script[src*=".js"]').map((o,e)=>$(e).attr("src")).get()),e=()=>{var o=(new Date).getTime();return window.pjaxSerialNumber=o,console.log("sn = "+o),o};cachedScript=(o,e)=>jQuery.ajax(jQuery.extend({url:o,type:"get",dataType:"script",cache:!0,success:e},jQuery.isPlainObject(o)&&o)),$(document).on("click","a[target!=_blank][href]:not(data-not-pjax)",o=>{$.pjax.click(o,".column-main",{scrollTo:0,fragment:".column-main",serialNumber:e(),timeout:8e3})}),$(document).on("submit","form[data-pjax]",function(o){$.pjax.submit(o,".column-main",{scrollTo:0,fragment:".column-main",serialNumber:e(),timeout:8e3})}),$(document).on("pjax:click",function(o,e){console.log("------------------------"),console.log("pjax:click sn = "+e.serialNumber)}),$(document).on("pjax:beforeSend",function(o,e,n){console.log("pjax:beforeSend sn = "+n.serialNumber)}),$(document).on("pjax:start",function(o,e,n){console.log("pjax:start sn = "+n.serialNumber)}),$(document).on("pjax:send",function(o,e,n){console.log("pjax:send sn = "+n.serialNumber)}),$(document).on("pjax:clicked",function(o,e){console.log("pjax:clicked sn = "+e.serialNumber)}),$(document).on("pjax:beforeReplace",function(o,e,n){console.log("pjax:beforeReplace sn = "+n.serialNumber),$(".navbar-nav .current,.panel-side-menu .current").removeClass("current"),commonContext.initNavbar(),0<$("html.disable-scroll").length&&$(".navbar-mask").trigger("click")}),$(document).on("pjax:success",async function(o,e,n,t,c){console.log("pjax:success sn = "+c.serialNumber),commonContext.initGallery(),commonContext.initTocAndNotice();const a=$($.parseHTML(e,document,!0)),s=$("head");a.filter("link[data-pjax]").each(function(){let o=$(this).attr("href");i.has(o)||(s.append($(this)),console.log("加载css "+$(this).attr("href")),this.onload=function(){i.add(o),console.log("加载css完成 "+$(this).attr("href"))})});let l=a.filter("script[data-pjax]"),r=l.length;await new Promise(e=>{l.each(function(){let o=$(this).attr("src");u.has(o)?0==--r&&e():this.defer||this.async?(console.log("异步加载js "+o),cachedScript(o).done(function(){console.log("异步加载js完成 "+o),u.add(o)}).fail(function(){console.log("异步加载js失败 "+o)}),0==--r&&e()):(console.log("同步加载js "+o),cachedScript(o).done(function(){console.log("同步加载js完成 "+o),u.add(o),0==--r&&e()}).fail(function(){console.log("同步加载js失败 "+o),0==--r&&e()}))})}),console.log("全部处理完成"),window.journalPjax&&window.journalPjax(),window.postPjax&&window.postPjax()}),$(document).on("pjax:timeout",function(o,e,n){console.log("pjax:timeout sn = "+n.serialNumber)}),$(document).on("pjax:error",function(o,e,n,t,c){console.log(`pjax:error sn = ${c.serialNumber} error `+t)}),$(document).on("pjax:complete",function(o,e,n,t){console.log("pjax:complete sn = "+t.serialNumber)}),$(document).on("pjax:end",function(o,e,n){console.log("pjax:end sn = "+n.serialNumber),null==e&&commonContext.initTocAndNotice()}),$(document).on("pjax:popstate",function(){console.log("pjax:popstate")})})();